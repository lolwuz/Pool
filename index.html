<!DOCTYPE html>
<html>
<head>
    <title>Super pool</title>
    <meta charset=utf-8>
    <meta name="description" content="Super bool, amazing 3D pool game in THREE.js">
    <meta name="tags" content="pool, billiard, eight-ball, 3d, threejs">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="css/index.css">

    <!-- Compiled and minified CSS -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
</head>
<body onload="askPlayerNames()">

<!-- Content -->
<div class="row" style="position: absolute; top: 10px; left: 10px">
    <div class="col">
        <div class="card blue-grey darken-1">
            <div class="card-content white-text">
                <span class="card-title" id="player1name">Player 1:</span>
                <p id="player1turn">blablabla</p>
            </div>
            <div class="card-action">
                <a href="#">Link</a>
                <a href="#">Link</a>
            </div>
        </div>
    </div>
</div>

<div class="row" style="position: absolute; top: 10px; right: 10px">
    <div class="col">
        <div class="card blue-grey darken-1">
            <div class="card-content white-text">
                <span class="card-title" id="player2name">Player 2:</span>
                <p id="player2turn">blablabla</p>
            </div>
            <div class="card-action">
                <a href="#">Link</a>
                <a href="#">Link</a>
            </div>
        </div>
    </div>
</div>

<canvas id="poolCanvas"></canvas>
<!-- /Content -->

<!-- Scripts -->
<script src="js/three.js"></script>
<script src="js/loaders/OBJLoader2.js"></script>
<script src="js/controls/OrbitControls.js"></script>
<script src="Objects/Ball.js"></script>
<script src="Objects/Table.js"></script>
<script src="Objects/Cue.js"></script>
<script src="Objects/Player.js"></script>
<script src="Objects/Game.js"></script>
<script>
    init();
    animate();

    var game;
    var mouse = new THREE.Vector2();
    var raycaster = new THREE.Raycaster();

    function init(){
        game = new Game();
        window.addEventListener( 'resize', onWindowResize, false );
        document.addEventListener("keydown", onDocumentKeyDown, false);
        document.addEventListener( 'click', onDocumentMouseClick, false );
    }

    function animate(){  
        requestAnimationFrame( animate );
        game.update();

        // Check turn of player
        /*
        if (game.players[0].isMyTurn) {
            document.getElementById("player1turn").innerText = "It's my turn :)";
            document.getElementById("player2turn").innerText = "It's not my turn ;(";
        } else {
            document.getElementById("player1turn").innerText = "It's not my turn ;(";
            document.getElementById("player2turn").innerText = "It's my turn :)";
        }
        */
    }

    function askPlayerNames() {
        document.getElementById("player1name").innerText += " " + prompt("Please enter name for player 1","");
        document.getElementById("player2name").innerText += " " + prompt("Please enter name for player 2", "");
    }

    function onDocumentKeyDown(event) {
        var keyCode = event.which;
        if (keyCode === 87) {
            game.cue.rotateDegrees(0.1); // W
        } else if (keyCode === 83) {
            game.cue.rotateDegrees(0.1); // S
        } else if (keyCode === 65) {
            game.cue.rotateDegrees(-0.1); // A
        } else if (keyCode === 68) {
            game.cue.rotateDegrees(0.1); // D
        } else if (keyCode === 32) {
            game.cue.shoot(0.8); // Space
        }
    }

    function onDocumentMouseClick(event){
        mouse.x = ( event.clientX / window.innerWidth ) * 2 - 1;
        mouse.y = - ( event.clientY / window.innerHeight ) * 2 + 1;
        raycaster.setFromCamera( mouse.clone(), game.camera );

        var intersect = raycaster.intersectObjects(game.ballArray);

        for ( let i = 0; i < intersect.length; i++ ) {
            game.cue.setBall(intersect[i].object);
            game.camera.lookAt(game.cue.selectedBall.position);
        }
    }

    function onWindowResize() {
        game.camera.aspect = window.innerWidth / window.innerHeight;
        game.camera.updateProjectionMatrix();
        game.renderer.setSize( window.innerWidth, window.innerHeight );
    }

</script>
<!-- /Scripts -->
</body>
</html>